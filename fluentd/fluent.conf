 <source>
  @type tail
  @id in_tail_container_logs
  path /var/lib/docker/containers/*/*-json.log
  pos_file /fluentd/log/containers.log.pos
  time_format "%Y-%m-%dT%H:%M:%S.%L%Z"
  keep_time_key true
  read_from_head true
  tag "docker.*"
  format json
</source>

<filter docker.var.lib.docker.containers.*.*.log>
  @type docker_metadata
  labels com.docker.stack.namespace:namespace,com.docker.swarm.service.name:service_name,com.docker.swarm.node.id:node_id
</filter>

<match docker.var.lib.docker.containers.*.*.log>
  @type rewrite_tag_filter
  <rule>
    key container_name
    pattern ^(.+)_(nginx)(.+)$
    tag nginx
  </rule>
    <rule>
    key container_name
    pattern ^(.+)_(rewards-calculator-app)(.+)$
    tag rewards
  </rule>
</match>


<match nginx>
  @type mongo
  connection_string mongodb://radixdb:HI93es6XRLw3rvTeZ5VodIUopOTmP136DReUZwdkthtuzZgTPSDzCTieKbxCnW34IK7r6mckyLZ5TChS7nQs3g==@radixdb.mongo.cosmos.azure.com:10255/?ssl=true&replicaSet=globaldb&retrywrites=false&maxIdleTimeMS=120000&appName=@radixdb@
  collection nginx
</match>

<match rewards>
  @type mongo
  connection_string mongodb://radixdb:HI93es6XRLw3rvTeZ5VodIUopOTmP136DReUZwdkthtuzZgTPSDzCTieKbxCnW34IK7r6mckyLZ5TChS7nQs3g==@radixdb.mongo.cosmos.azure.com:10255/?ssl=true&replicaSet=globaldb&retrywrites=false&maxIdleTimeMS=120000&appName=@radixdb@
  collection rewards
</match>
